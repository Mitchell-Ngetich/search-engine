<%= form_with(model: @user_search, url: user_searches_path, method: :post, html: { class: 'form', id: 'userSearchForm', novalidate: true }) do |form| %>
  <div class="form-group">
    <%= form.label :search_query, 'Search Query' %>
    <%= form.text_field :search_query, id: 'searchQuery', class: 'form-control', placeholder: 'Enter your search query', required: true %>
  </div>

  <div class="form-group">
    <%= form.hidden_field :ip_address, id: 'ipAddress', value: request.remote_ip %>
  </div>

  <div class="text-center">
    <%= form.submit 'Search', class: 'btn btn-primary' %>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const userSearchForm = document.getElementById("userSearchForm");
    const searchQueryInput = document.getElementById("searchQuery");
    const ipAddressInput = document.getElementById("ipAddress");

    // Event listener for form submission
    userSearchForm.addEventListener("submit", function (event) {
      if (!userSearchForm.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      userSearchForm.classList.add('was-validated');
    });

    // Event listener for search query input
    searchQueryInput.addEventListener('keyup', function() {
      const searchQuery = searchQueryInput.value;
      const ipAddress = ipAddressInput.value;
      fetch('<%= user_searches_path %>', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify({ user_search: { search_query: searchQuery, ip_address: ipAddress } })
      });
    });
  });
</script>